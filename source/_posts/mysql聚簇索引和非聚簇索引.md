---
title: mysql聚簇索引和非聚簇索引
date: 2020-09-29 19:44:16
tags: mysql
---
按照索引是否和数据存放在一起,索引可分为聚簇索引和非聚簇索引.

# 1聚簇索引
具体的细节依赖于其实现方式

以mysql innodb为例,innodb 支持聚簇索引和非聚簇索引
两者的结构都是基于B+tree的

聚簇索引是将索引和数据存放在一起,且数据的排列顺序和索引的排列顺序是一致.一个表只能有一个聚簇索引.
默认情况下,会将表的主键作为聚簇索引.
如果数据表没有设置主键,mysql会默认生成6个字节的自增主键.

下图展示了innodb的聚簇索引存放数据的方式
<!--more-->
![Alt text](/images/b+tree.png) 

数据都保存在索引的B+tree叶子节点上.

## 1.1 聚簇索引的优点
a 查询速度快. 聚簇索引和数据在同一个B+Tree上,找到索引即找到数据.
b 由于叶子节点保存了多个索引和数据,在某些场景下可以减少IO.
如 上图结构,第一次查找主键=3,会把 页4加载到内存中.
此时如果再查找主键10,由于页4已经在内存中,所以可以直接从内存中读,无须再读取硬盘.

## 1.2 聚簇索引的缺点
a在有聚簇索引的表插入新的记录,或者更新聚簇索引对应的列(更新主键值),有可能导致页分裂.

# 2非聚簇索引

索引和数据分开存储,索引的B+Tree上叶子节点保存主键的值(mysiam非聚簇索引保存的是 数据行对应的指针).

如图

![Alt text](/images/b+tree_data.png) 

## 2.1 非聚簇索引的优点
a 叶子节点不保存所有列的数据,只保存主键的值,所以占用空间小.(mysiam的叶子节点保存的是 数据行对应的指针)


## 2.2 非聚簇索引的缺点
a 非聚簇索引索引需要二次查询 
innodb中,非聚簇索引叶子节点保存的是主键的值,所以需要查询二次.
