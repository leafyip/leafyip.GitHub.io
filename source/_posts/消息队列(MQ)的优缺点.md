---
title: 消息队列(MQ)的优缺点
date: 2020-10-05 17:48:36
tags: MQ
---

# 优点
## 1 异步

假如系统是同步调用,A本地执行需要300ms,A调用B,网络通信以及B执行时间加起来也是300ms,A调用C网络通信以及C执行时间加起来也是300ms.
那用户等待的总时长为300ms + 300ms + 300ms = 900ms , 假如还有系统D,E,F呢....

![Alt text](/images/mq_sync.png) 


如果系统之间的接口可以异步调用,那可以考虑引入MQ消息中间件
引入消息中间间后系统的调用如图

![Alt text](/images/mq_async.png) 

用户调用系统A
系统A执行成功后往MQ注册消息
然后返回结果给用户

系统B,C,D...N 监听MQ中的数据,然后执行对应的业务逻辑
<!--more-->


## 2 解耦

还是如上的例子, 系统A 需要调用系统B,C的接口发送数据,假如此时又有系统D接入进来.
那么系统A 需要新增调用系统D的代码.

但如果此时C系统不需要A的数据了,
那么系统A又要移除调用系统C的代码

引入MQ后,A只需要往MQ中放数据
然后其他系统按需获取即可.

## 3 削峰

系统A集群部署,可支持 1W QPS.
系统A调用系统B接口,系统B也是集群,但B由于数据库或者其他原因等,无论怎么拓展也只能最大支持 5000 QPS.

根据木桶原理,此时整个系统最大支持的QPS 为 5000.
![Alt text](/images/mq_traffic.png) 



引入MQ 后, 系统A可以处理 1W QPS,然后将数据都放进MQ里,
系统B按照5000QPS的速度消化MQ的数据. 

只要系统B的消化速度保持 5000 QPS,当系统A的流量减少,往MQ投放的速度少于系统B的消化速度时,终有一刻,B会消化完所有数据.

引入MQ后,系统的QPS 提高至1W.
![Alt text](/images/mq_reduce_traffic.png) 

# 缺点

## 1 系统可用性降低.
系统引入的外部组件越多,可用性越低.
引入MQ之前,只要系统A,系统B,系统C正常服务,整个系统就可以正常对外提供服务.
引入MQ之后,即使系统A,B,C,正常运行,但如果MQ宕机,会导致整个系统出现问题.

## 系统复杂度提高
引入MQ之后要考虑很多问题,如消息丢失,重复消费等

## 数据一致性问题
如图
![Alt text](/images/mq_async.png) 

假设系统A,系统B都正确更新数据,但系统C出现异常,会导致整个系统的数据不一致
